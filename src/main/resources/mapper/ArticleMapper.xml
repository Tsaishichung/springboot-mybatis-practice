<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.cust.course.Course.common.mapper.ArticleMapper">
  <resultMap id="BaseResultMap" type="edu.cust.course.Course.common.model.Article">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Dec 15 00:35:15 CST 2016.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="article_name" jdbcType="VARCHAR" property="article_name" />
    <result column="create_time" jdbcType="DATE" property="create_time" />
    <result column="article_uuid_name" jdbcType="VARCHAR" property="article_uuid_name" />
    <result column="article_extend_name" jdbcType="VARCHAR" property="article_extend_name" />
    <result column="is_used" jdbcType="INTEGER" property="is_used" />
    <result column="download_count" jdbcType="INTEGER" property="download_count" />
    <result column="view_count" jdbcType="INTEGER" property="view_count" />
    <result column="type" jdbcType="VARCHAR" property="type" />
    <result column="article_user" jdbcType="INTEGER" property="article_user" />
  </resultMap>
  <select id="loadHotArticleList" parameterType="string" resultMap="BaseResultMap">
  select * FROM article ORDER BY download_count*5+view_count DESC 
	  <if test="_parameter!=null">
	  	limit 8
	  </if>
  </select>
  <!-- 查询显示正文 -->
  <select id="selectOne" parameterType="int" resultMap="BaseResultMap">
 		 select * from article where id=#{param1}
  </select>
  <!-- 下载数增加 -->
  <update id="updateDownloadCount" parameterType="int">
  	UPDATE article SET download_count=download_count+1 WHERE id = #{param1}
  </update>
  <!-- 阅读数增加 -->
  <update id="updateViewCount" parameterType="int">
  	UPDATE article SET view_count=view_count+1 WHERE id = #{param1}
  </update>
  <!-- 显示文章总数 -->
  <select id="countArticle" parameterType="map" resultType="int">
  select count(*) from article where is_used=1
	<if test="arType!=null">
	and type=#{arType}
	</if> 
	<if test="article_name!=null">
	and article_name like '#{article_name}%'
	</if> 
  </select>
  <!-- 查询出文章信息列表 -->
  <select id="loadArticleListBySelect" parameterType="map" resultMap="BaseResultMap">
  	select * from article where is_used=1
  	<if test="arType!=null">
	and type=#{arType}
	</if> 
	<if test="article_name!=null">
	and article_name like '#{article_name}%'
	</if> 
		order by create_time desc
  	 limit #{show_count} offset #{start_size} 
  </select>
  <!-- 查询用户的文章信息 -->
  <select id="selectArticleByUserId" parameterType="map" resultMap="BaseResultMap">
	 select * from article where article_user = #{id}
	 <if test="status!=null">
	 	and is_used=#{status}
	 </if>
	 order by create_time desc
	  limit #{show_count} offset #{start_size} 
  </select>
  <!-- 查询用户文章数，条件查询 -->
  <select id="selectArticleCountByUserId" parameterType="map" resultType="int">
	 select count(*) from article where article_user = #{id}
	 <if test="status!=null">
	 	and is_used=#{status}
	 </if>
	  limit #{show_count} offset #{start_size} 
  </select>
  <!-- 用户上传文章 -->
  <insert id="upload" parameterType="map">
		insert into article (article_name,article_uuid_name,article_extend_name,is_used,type,article_user)
		values(#{article_name},#{article_uuid_name},#{extend_name},#{is_used},#{type},#{id})
  </insert>
  <!-- 查询文章总记录数 -->
  <select id="selectArticleCountByManage" parameterType="map" resultType="int">
  	select count(*) from article where 1=1
  	<if test="status!=null">
  	 and is_used=#{status}
  	</if>
  </select>
  <!-- 查询文章总记录数 -->
  <select id="selectArticleInfoByManage" parameterType="map" resultMap="BaseResultMap">
  	select * from article where 1=1 
  	<if test="status!=null">
  	 and is_used=#{status}
  	</if>
  	limit #{page_size} offset #{start_size}
  </select>
  <!-- 论文状态变更 -->
  <update id="updateArticle">
  		update article set is_used=#{param2} where id=#{param1}
  </update>
</mapper>